#!/bin/bash
                                                                                     
## Lab : LISN ~ UMR9015 ~ BIOINFO team

#SBATCH --job-name=exploitation
#SBATCH --array=1
#SBATCH --mem-per-cpu=32GB
#SBATCH --account=inferscerevol

# Necessary libraries 
module load python/3.12 #python/3.10 # test to try and debug smc++


# ---------------- recup args --------------------------
for ARGUMENT in "$@"
do
   KEY=$(echo $ARGUMENT | cut -f1 -d=)

   KEY_LENGTH=${#KEY}
   VALUE="${ARGUMENT:$KEY_LENGTH+1}"

   export "$KEY"="$VALUE"
done
echo "SIMU_TYPE = $SIMU_TYPE"
#echo "STAIRWAY_SUM = $STAIRWAY_SUM"
#echo "DADI = $DADI"
echo "Nu = $Nu"

if [ -v POPSIZE ]; then
	echo "POPSIZE = $POPSIZE"
	popsize=$POPSIZE # Population size 
else 
	popsize=10000 # Population size 
fi

if [ -v NBR_GEN ]; then
	echo "NBR_GEN = $NBR_GEN"
	nbr_gen=$NBR_GEN # Number of generation
else 
	nbr_gen=10000 # Population size 
fi

if [ -v T_THEO ]; then
	echo "T_Theo = $T_THEO"
	T_Theo=$T_THEO # Number of generation
else 
	T_Theo=0.1 # Population size 
fi

if [ -v REP ]; then
	echo "REP = $REP"
	rep=$REP # Number of generation
else 
	rep=1 # Population size 
fi

echo "REP = $rep"


for GR in 1 10 50 100; do
	echo "GR = $GR"
	stair_path="../deminfhelper/${SIMU_TYPE}/output_stairwayplot2_${GR}/cerevisiae/cerevisiae.final.summary"
	dadi_path="../../results/dadi_louis/${SIMU_TYPE}_${rep}/infered_param_${SIMU_TYPE}_${GR}_.csv"
	echo "dadi_path = $dadi_path"
	echo "stair_path = $stair_path"
	python3 data_extraction.py --dadi_louis $dadi_path --stairway_path $stair_path --nbr_generation $nbr_gen --Ninit $popsize --simu_type $SIMU_TYPE --rep $rep --GR $GR
	done


path_stair_data="../data/stairway/coords/${rep}"
path_stair_inf_params="../data/stairway/${rep}"
path_dadi_data="../data/dadi/coords/${rep}"
path_dadi_inf_params="../data/dadi/${rep}"
python3 exploitation_data.py --path_stair_data $path_stair_data --path_dadi_data $path_dadi_data --path_stair_inf_params $path_stair_inf_params --path_dadi_inf_params $path_dadi_inf_params --event_ratio $Nu  --nbr_generation $nbr_gen --T_theo $T_Theo --Ninit $popsize --simu_type $SIMU_TYPE
#python3 creation_graph.py --path_stair_inf_params $path_stair_inf_params --path_dadi_inf_params $path_dadi_inf_params --Nu_theo $Nu --T_theo $T_Theo --Ninit $popsize --simu_type $SIMU_TYPE
	